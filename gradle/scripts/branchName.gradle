tasks.register('checkBranchName') {
  doLast {
    if (!project.hasProperty('branch_name')) {
      throw new GradleException("Error: Missing required property 'branch_name'.")
    }

    def branch_name = project.property('branch_name')

    def patterns = [
      ~/^(developer|develop|dev)$/,
      ~/.*rel\/.*/,
      ~/^dependabot\/.*$/,
      ~/.*hotfix\/\pL{2}\/#\d+.*/,
      ~/.*main/,
      ~/^[a-z]{2}\/#[0-9]+(?:-.+)?$/
    ]

    def isValid = patterns.any { pattern -> branch_name ==~ pattern }

    if (!isValid) {
      throw new GradleException("Error: Check Branch name format (e.g., ps/#1337-FeatureName). Current branch name is $branch_name.")
    }

    println "Branch name is $branch_name"
  }
}
