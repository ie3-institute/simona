@startuml
'https://plantuml.com/sequence-diagram

' set fixed order
participant Scheduler
participant EmAgent
participant PvAgent
participant StorageAgent
participant WeatherService

autonumber

==Init==

PvAgent -> WeatherService: RegisterForWeatherMessage
activate PvAgent
activate WeatherService
PvAgent -> EmAgent: RegisterParticipant
deactivate PvAgent

WeatherService -> PvAgent: RegistrationSuccessfulMessage
deactivate WeatherService
activate PvAgent
PvAgent -> EmAgent: ScheduleFlexRequest
deactivate PvAgent
activate EmAgent

EmAgent -> Scheduler: ScheduleActivation
deactivate EmAgent

StorageAgent -> EmAgent: RegisterParticipant
StorageAgent -> EmAgent: ScheduleFlexRequest

==Simulation==

Scheduler -> WeatherService: Activation
activate WeatherService

WeatherService -> PvAgent: ProvideWeatherMessage

WeatherService -> Scheduler: Completion
deactivate WeatherService

Scheduler -> EmAgent: Activation
activate EmAgent

EmAgent -> StorageAgent: RequestFlexOptions
activate StorageAgent

EmAgent -> PvAgent: RequestFlexOptions
activate PvAgent

PvAgent -> EmAgent: ProvideFlexOptions
deactivate PvAgent

StorageAgent -> EmAgent: ProvideFlexOptions
deactivate StorageAgent

EmAgent -> PvAgent: IssueNoControl
activate PvAgent

EmAgent -> StorageAgent: IssuePowerControl
activate StorageAgent

PvAgent -> EmAgent: FlexCompletion
deactivate PvAgent

StorageAgent -> EmAgent: FlexCompletion
deactivate StorageAgent

EmAgent -> Scheduler: Completion
deactivate EmAgent

@enduml